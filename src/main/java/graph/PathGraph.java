package graph;

import vo.MethodCall;

import java.util.*;

public class PathGraph implements IGraph {

    Map<String, PathNode> nodeNameMap;
    Map<String, Set<Integer>> callLineNumberMap;

    public PathGraph(Map<String, PathNode> nodeNameMap, List<MethodCall> calls, Map<String, Set<Integer>> callLineNumberMap) {
        this.nodeNameMap = nodeNameMap;
        this.callLineNumberMap = callLineNumberMap;
        for (MethodCall call : calls) {
            addEdge(call);
        }
    }

    private void addEdge(MethodCall call) {
        nodeNameMap.get(call.getSrc()).addOutNode(call.getTgt());
    }


    public Set<String> getHostNodes() {
        Set<String> hostNds = new HashSet<>();
        for (PathNode node : nodeNameMap.values()) {
            if (node.isHostNode())
                hostNds.add(node.getName());
        }
        return hostNds;
    }

    @Override
    public INode getNode(String nodeName) {
        return nodeNameMap.get(nodeName);
    }


    public Map<String, PathNode> getName2Node() {
        return nodeNameMap;
    }

    public Map<String, Set<Integer>> getCallLineNumberMap() {
        return callLineNumberMap;
    }

    @Override
    public Collection<String> getAllNode() {
        return nodeNameMap.keySet();
    }
}
