package soot.transformer;

import graph.IGraph;
import soot.SceneTransformer;
import soot.jimple.toolkits.callgraph.CHATransformer;
import utiil.MavenUtil;

import java.util.HashMap;
import java.util.Map;

public abstract class CallGraphTransformer extends SceneTransformer {
    protected IGraph graph;

    @Override
    protected void internalTransform(String s, Map<String, String> map) {
        MavenUtil.i().getLog().info("call graph transformer start..");
        Map<String, String> cgMap = new HashMap<>();

        cgMap.put("enabled", "true");
        cgMap.put("apponly", "true");
        cgMap.put("all-reachable", "true");

        initMthd2branch();

        CHATransformer.v().transform("wjtp", cgMap);

        formGraph();

        MavenUtil.i().getLog().info("call graph transformer end..");
    }

    protected abstract void initMthd2branch();

    protected abstract void formGraph();

    public IGraph getGraph() {
        return graph;
    }
}
